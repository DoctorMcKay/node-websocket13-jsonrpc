{"version":3,"file":"JsonRpcWebSocket.min.js","names":["JsonRpcWebSocket","url","_requestHandlers","_notificationHandlers","_responseHandlers","_nextMsgId","addEventListener","e","data","close","JSON","parse","ex","console","error","isRequest","method","isResponse","id","result","jsonrpc","_sendError","handler","params","err","_sendResponse","RpcError","code","message","readyState","WebSocket","OPEN","_open","response","send","stringify","name","callback","Error"],"sources":["JsonRpcWebSocket.js"],"sourcesContent":["/**\r\n * JSON-RPC 2.0 WebSocket client\r\n * @author Alex Corn <alex@alexcorn.com>\r\n */\r\n\r\nclass JsonRpcWebSocket extends WebSocket {\r\n\tconstructor(url) {\r\n\t\tsuper(url, 'jsonrpc-2.0');\r\n\r\n\t\tthis._requestHandlers = {};\r\n\t\tthis._notificationHandlers = {};\r\n\t\tthis._responseHandlers = {};\r\n\t\tthis._nextMsgId = 1;\r\n\r\n\t\tthis.addEventListener('message', (e) => {\r\n\t\t\tif (typeof e.data != 'string') {\r\n\t\t\t\tthis.close(1003, 'Unacceptable data type');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet data = e.data;\r\n\t\t\ttry {\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\tconsole.error(ex);\r\n\t\t\t\tthis.close(1007, 'Error parsing JSON');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet isRequest = typeof data.method == 'string';\r\n\t\t\tlet isResponse = typeof data.id != 'undefined' && (typeof data.result != 'undefined' || typeof data.error == 'object');\r\n\r\n\t\t\t// Make sure it's a well-formed JSON-RPC object\r\n\t\t\tif (data.jsonrpc !== '2.0' || (!isRequest && !isResponse)) {\r\n\t\t\t\treturn this._sendError(data.id || null, -32600, 'Invalid Request');\r\n\t\t\t}\r\n\r\n\t\t\tif (isRequest) {\r\n\t\t\t\tif (typeof data.id != 'undefined') {\r\n\t\t\t\t\t// This is a request\r\n\t\t\t\t\tlet handler = this._requestHandlers[data.method];\r\n\t\t\t\t\tif (typeof handler != 'function') {\r\n\t\t\t\t\t\treturn this._sendError(data.id, -32601, 'Method not found', {method: data.method});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Invoke the handler\r\n\t\t\t\t\thandler(data.params, (err, result) => {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\tif (err instanceof RpcError) {\r\n\t\t\t\t\t\t\t\tthis._sendError(data.id, err.code, err.message, err.data);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow err;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._sendResponse(data.id, result);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// This is a notification\r\n\t\t\t\t\tlet handler = this._notificationHandlers[data.method];\r\n\t\t\t\t\tif (typeof handler != 'function') {\r\n\t\t\t\t\t\treturn this._sendError(null, -32601, 'Method not found', {method: data.method});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Invoke the handler. No need to worry about responses or errors.\r\n\t\t\t\t\thandler(data.params);\r\n\t\t\t\t}\r\n\t\t\t} else if (isResponse && data.id !== null) {\r\n\t\t\t\tlet handler = this._responseHandlers[data.id];\r\n\t\t\t\tif (typeof handler != 'function') {\r\n\t\t\t\t\treturn this._sendError(null, -32000, 'Invalid response message ID');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete this._responseHandlers[data.id];\r\n\t\t\t\thandler(data);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget _open() {\r\n\t\treturn this.readyState == WebSocket.OPEN;\r\n\t}\r\n\r\n\t/**\r\n\t* Send an error response.\r\n\t* @param {*} id\r\n\t* @param {JsonRpcErrorCode|number} code\r\n\t* @param {string} message\r\n\t* @param {object|null} data\r\n\t* @private\r\n\t*/\r\n\t_sendError(id, code, message, data = null) {\r\n\t\tif (!this._open) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet response = {\r\n\t\t\tjsonrpc: '2.0',\r\n\t\t\terror: {\r\n\t\t\t\tcode,\r\n\t\t\t\tmessage\r\n\t\t\t},\r\n\t\t\tid\r\n\t\t};\r\n\r\n\t\tif (data) {\r\n\t\t\tresponse.error.data = data;\r\n\t\t}\r\n\r\n\t\tthis.send(JSON.stringify(response));\r\n\t}\r\n\r\n\t/**\r\n\t * Send a success response.\r\n\t * @param {*} id\r\n\t * @param {*} result\r\n\t * @private\r\n\t */\r\n\t_sendResponse(id, result) {\r\n\t\tif (!this._open) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.send(JSON.stringify({\r\n\t\t\tjsonrpc: '2.0',\r\n\t\t\tresult,\r\n\t\t\tid\r\n\t\t}));\r\n\t}\r\n\r\n\t/**\r\n\t * Register a handler for a method.\r\n\t * @param {string} name\r\n\t * @param {function} handler - A function to be invoked when the method is called.\r\n\t * Called with signature (any params, function respond)\r\n\t * respond is a function with signature (RpcError|null err, any result)\r\n\t */\r\n\tregisterMethod(name, handler) {\r\n\t\tthis._requestHandlers[name] = handler;\r\n\t}\r\n\r\n\t/**\r\n\t * Register a handler for an incoming notification. Notifications may not be responded to.\r\n\t * @param {string} name\r\n\t * @param {function} handler - Invoked with arguments (any params)\r\n\t */\r\n\tregisterNotification(name, handler) {\r\n\t\tthis._notificationHandlers[name] = handler;\r\n\t}\r\n\r\n\t/**\r\n\t * Send a notification. A JSON-RPC notification is a message that does not expect a response.\r\n\t * @param {string} method\r\n\t * @param {*} [params]\r\n\t * @returns {boolean} - false if the connection is not open\r\n\t */\r\n\tnotify(method, params) {\r\n\t\tif (!this._open) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.send(JSON.stringify({\r\n\t\t\tjsonrpc: '2.0',\r\n\t\t\tmethod,\r\n\t\t\tparams\r\n\t\t}));\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoke a method.\r\n\t * @param {string} method\r\n\t * @param {*} [params]\r\n\t * @param {function} callback - Called with signature (RpcError|null err, any result)\r\n\t * @returns {boolean} - false if the connection is not open\r\n\t */\r\n\tinvoke(method, params, callback) {\r\n\t\tif (!this._open) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (typeof params == 'function') {\r\n\t\t\tcallback = params;\r\n\t\t\tparams = undefined;\r\n\t\t}\r\n\r\n\t\tlet id = this._nextMsgId++;\r\n\t\tthis.send(JSON.stringify({\r\n\t\t\tjsonrpc: '2.0',\r\n\t\t\tmethod,\r\n\t\t\tparams,\r\n\t\t\tid\r\n\t\t}));\r\n\r\n\t\tthis._responseHandlers[id] = (response) => {\r\n\t\t\tif (response.error) {\r\n\t\t\t\treturn callback(new RpcError(response.error.message, response.error.code, response.error.data));\r\n\t\t\t} else {\r\n\t\t\t\treturn callback(null, response.result);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nclass RpcError extends Error {\r\n\t/**\r\n\t *\r\n\t * @param {string} message\r\n\t * @param {JsonRpcErrorCode|number} code - MUST be an integer\r\n\t * @param {object|null} data - Optional data to send along with the error\r\n\t */\r\n\tconstructor(message, code, data = null) {\r\n\t\tsuper(message);\r\n\t\tthis.code = code;\r\n\t\tthis.data = data;\r\n\t}\r\n}\r\n"],"mappings":"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"}